<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>üî• Quiz To√°n 8 - Ch∆∞∆°ng I üî•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; }
    .hidden { display: none; }
  </style>
</head>
<body class="bg-gradient-to-r from-pink-100 to-blue-200 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold mb-6">üî• Quiz To√°n 8 - Ch∆∞∆°ng I üî•</h1>

  <!-- Menu -->
  <div id="menuScreen" class="text-center">
    <p class="mb-4 text-gray-700">Ch·ªçn ch·∫ø ƒë·ªô ch∆°i:</p>
    <div class="flex gap-6 justify-center">
      <button onclick="startGame('single')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg">üéØ Ch∆°i ƒë∆°n</button>
      <button onclick="startGame('versus')" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-lg">‚öîÔ∏è ƒê·ªëi kh√°ng 2 c·ª≠a</button>
    </div>
  </div>

  <!-- Quiz Single -->
  <div id="quizSingle" class="hidden w-full max-w-2xl mt-6">
    <h2 class="text-xl font-bold text-green-600">üéØ Ch·∫ø ƒë·ªô Ch∆°i ƒë∆°n</h2>
    <p id="counterS" class="font-semibold">C√¢u 1/10</p>
    <div id="qBoxS" class="bg-white p-4 rounded-xl shadow mb-3 text-lg font-medium"></div>
    <div id="optsS" class="grid gap-2"></div>
    <button onclick="nextQ('S')" id="nextBtnS" class="hidden mt-3 bg-green-500 text-white px-4 py-2 rounded-lg">C√¢u ti·∫øp</button>
  </div>

  <!-- Quiz Versus -->
  <div id="quizVersus" class="hidden grid grid-cols-2 gap-6 w-full mt-6">
    <div>
      <h2 class="text-xl font-bold text-red-600">üîë C·ª≠a 1</h2>
      <p id="counter1" class="font-semibold">C√¢u 1/10</p>
      <div id="qBox1" class="bg-white p-4 rounded-xl shadow mb-3 text-lg font-medium"></div>
      <div id="opts1" class="grid gap-2"></div>
      <button onclick="nextQ(1)" id="nextBtn1" class="hidden mt-3 bg-green-500 text-white px-4 py-2 rounded-lg">C√¢u ti·∫øp</button>
    </div>
    <div>
      <h2 class="text-xl font-bold text-blue-600">üîë C·ª≠a 2</h2>
      <p id="counter2" class="font-semibold">C√¢u 1/10</p>
      <div id="qBox2" class="bg-white p-4 rounded-xl shadow mb-3 text-lg font-medium"></div>
      <div id="opts2" class="grid gap-2"></div>
      <button onclick="nextQ(2)" id="nextBtn2" class="hidden mt-3 bg-green-500 text-white px-4 py-2 rounded-lg">C√¢u ti·∫øp</button>
    </div>
  </div>

  <!-- Scoreboard -->
  <div id="scoreBoard" class="hidden mt-6 bg-white shadow-lg rounded-xl p-4">
    <p class="text-lg font-bold">üèÜ B·∫£ng ƒëi·ªÉm</p>
    <p>C·ª≠a 1: <span id="score1">0</span></p>
    <p>C·ª≠a 2: <span id="score2">0</span></p>
  </div>

  <!-- √Çm thanh -->
  <audio id="soundCorrect" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
  <audio id="soundWrong" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-buzz-950.mp3"></audio>
  <audio id="soundWin" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
  <audio id="soundLose" src="https://assets.mixkit.co/sfx/preview/mixkit-game-over-fail-2014.mp3"></audio>

<script>
let dataAll={}, quizDataS=[], quizData1=[], quizData2=[];
let idxS=0, idx1=0, idx2=0, score1=0, score2=0;

async function startGame(mode){
  if(Object.keys(dataAll).length===0){
    const res = await fetch("questions.json?_="+Date.now());
    dataAll = await res.json();
  }
  const allQs=[...dataAll.NB,...dataAll.TH,...dataAll.VD,...dataAll.VC];
  if(mode==='single'){
    quizDataS=pick(allQs,10);
    idxS=0;
    document.getElementById('menuScreen').classList.add('hidden');
    document.getElementById('quizSingle').classList.remove('hidden');
    showQ('S');
  }else{
    quizData1=pick(allQs,10);
    quizData2=pick(allQs,10);
    idx1=0; idx2=0; score1=0; score2=0;
    document.getElementById('menuScreen').classList.add('hidden');
    document.getElementById('quizVersus').classList.remove('hidden');
    document.getElementById('scoreBoard').classList.remove('hidden');
    showQ(1); showQ(2);
  }
}

function showQ(door){
  let idx=(door==='S'?idxS:(door===1?idx1:idx2));
  let quizData=(door==='S'?quizDataS:(door===1?quizData1:quizData2));
  let q=quizData[idx];
  if(!q) return;
  if(door==='S') document.getElementById('counterS').innerText=`C√¢u ${idx+1}/10`;
  else document.getElementById('counter'+door).innerText=`C√¢u ${idx+1}/10`;
  let cleanQ=q.q.replace(/^C√¢u\\s*\\d+:\\s*/,'');
  if(door==='S') document.getElementById('qBoxS').innerHTML=`<span class="text-xl font-bold">${cleanQ}</span>`;
  else document.getElementById('qBox'+door).innerHTML=`<span class="text-xl font-bold">${cleanQ}</span>`;
  let html='';
  shuffle([...q.options]).forEach(opt=>{
    html+=`<button onclick="answer('${door}',this,'${escape(q.a)}')" class="bg-white border p-2 rounded-lg hover:bg-yellow-100 text-lg">${opt}</button>`;
  });
  if(door==='S') document.getElementById('optsS').innerHTML=html;
  else document.getElementById('opts'+door).innerHTML=html;
  if(door==='S') document.getElementById('nextBtnS').classList.add('hidden');
  else document.getElementById('nextBtn'+door).classList.add('hidden');
}

function answer(door,btn,correct){
  let buttons=document.querySelectorAll('#opts'+door+' button');
  buttons.forEach(b=>b.disabled=true);
  let chosen=btn.innerText.trim();
  if(chosen===correct){
    btn.classList.add('bg-green-300');
    playSound("soundCorrect");
    if(door===1){score1+=10;updateScore();}
    else if(door===2){score2+=10;updateScore();}
  }else{
    btn.classList.add('bg-red-300');
    playSound("soundWrong");
    buttons.forEach(b=>{if(b.innerText.trim()===correct){b.classList.add('ring-2','ring-green-600')}})
  }
  if(door==='S') document.getElementById('nextBtnS').classList.remove('hidden');
  else document.getElementById('nextBtn'+door).classList.remove('hidden');
}

function updateScore(){
  document.getElementById('score1').innerText=score1;
  document.getElementById('score2').innerText=score2;
}

function nextQ(door){
  if(door==='S'){idxS++;if(idxS<quizDataS.length){showQ('S');}else endGame('S');}
  else if(door===1){idx1++;if(idx1<quizData1.length){showQ(1);}else endGame();}
  else{idx2++;if(idx2<quizData2.length){showQ(2);}else endGame();}
}

function endGame(mode){
  if(mode==='S'){
    alert("üéâ K·∫øt th√∫c ch∆°i ƒë∆°n!");
    location.reload();
  }else if(idx1>=10&&idx2>=10){
    let msg="üéâ Tr·∫≠n ƒë·∫•u k·∫øt th√∫c!\\n";
    msg+=`C·ª≠a 1: ${score1} ƒëi·ªÉm\\nC·ª≠a 2: ${score2} ƒëi·ªÉm\\n`;
    if(score1>score2){msg+="üëâ C·ª≠a 1 Th·∫Øng!";playSound("soundWin");}
    else if(score2>score1){msg+="üëâ C·ª≠a 2 Th·∫Øng!";playSound("soundWin");}
    else{msg+="ü§ù H√≤a!";playSound("soundLose");}
    alert(msg);location.reload();
  }
}

function playSound(id){document.getElementById(id).play();}

function pick(arr,n){let out=[];let used=new Set();while(out.length<n){let r=Math.floor(Math.random()*arr.length);if(!used.has(r)){out.push(arr[r]);used.add(r);}}return out;}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function escape(s){return (s||'').replace(/\\\\/g,'\\\\\\\\').replace(/'/g,"\\\\'").replace(/"/g,'\\\\\\"');}
</script>

</body>
</html>
