<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üî• Quiz To√°n 8 ‚Äì Ch∆∞∆°ng I</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn { 
      @apply w-full px-4 py-3 rounded-xl border font-semibold shadow-sm transition;
      display: block; text-align: left; line-height: 1.5;
    }
    .btn:hover { transform: translateY(-1px); }
    .correct {
      background:#16a34a !important;
      border-color:#15803d !important;
      color:#fff !important;
    }
    .wrong {
      background:#fca5a5 !important;
      border-color:#dc2626 !important;
      color:#7f1d1d !important;
      font-weight:bold;
    }
    .disabled { pointer-events:none; opacity:0.9; }
    .btn span { word-break: break-word; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-indigo-100 text-gray-800">

  <header class="max-w-4xl mx-auto px-4 pt-6 pb-2">
    <h1 class="text-center text-3xl md:text-4xl font-extrabold tracking-tight">
      üî• Quiz To√°n 8 ‚Äì Ch∆∞∆°ng I üî•
    </h1>
  </header>

  <main class="max-w-4xl mx-auto px-4 my-6 grid md:grid-cols-3 gap-4">
    <!-- Question -->
    <section class="md:col-span-2 bg-white/90 rounded-2xl p-6 shadow-lg border">
      <div class="flex items-center justify-between mb-4">
        <div>
          <div id="statusLine" class="text-sm text-gray-600">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
          <div id="qCounter" class="text-lg font-bold">C√¢u 0/10</div>
        </div>
        <div class="w-44">
          <div class="text-xs text-gray-500 mb-1">‚è±Ô∏è Th·ªùi gian c√≤n</div>
          <div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
            <div id="timeBar" class="h-full bg-emerald-500" style="width:0%"></div>
          </div>
        </div>
      </div>

      <div id="questionBox" class="rounded-xl bg-gray-50 px-4 py-3 text-lg font-semibold min-h-[64px]"></div>
      <div id="optionsBox" class="mt-4 grid gap-2"></div>

      <div class="mt-4 flex items-center gap-3">
        <button id="nextBtn" class="rounded-xl bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 font-semibold shadow">
          C√¢u ti·∫øp ‚ñ∂
        </button>
      </div>
    </section>

    <!-- Score -->
    <aside class="bg-white/90 rounded-2xl p-6 shadow-lg border">
      <h3 class="text-xl font-extrabold mb-2">üèÜ B·∫£ng ƒëi·ªÉm</h3>
      <ul class="text-sm space-y-1">
        <li>Ng∆∞·ªùi ch∆°i: <span id="hudName" class="font-semibold">‚Äî</span></li>
        <li>ƒêi·ªÉm hi·ªán t·∫°i: <span id="hudScore" class="font-semibold">0</span></li>
        <li>ƒê√∫ng/Sai: <span id="hudRightWrong" class="font-semibold">0 / 0</span></li>
        <li>Th·ªùi gian: <span id="hudTime" class="font-semibold">30s</span>/c√¢u</li>
      </ul>
    </aside>
  </main>

  <script>
    const el = id => document.getElementById(id);

    // chuy·ªÉn ^n th√†nh l≈©y th·ª´a unicode
    function formatPower(text){
      if(!text) return "";
      const map = {"0":"‚Å∞","1":"¬π","2":"¬≤","3":"¬≥","4":"‚Å¥","5":"‚Åµ","6":"‚Å∂","7":"‚Å∑","8":"‚Å∏","9":"‚Åπ"};
      return text.replace(/\^(\d+)/g, (_,exp)=>{
        return [...exp].map(d=>map[d]||d).join("");
      });
    }

    const STATE = { allData:{}, pool:[], quiz:[], idx:0, score:0, right:0, wrong:0, duration:30, timeLeft:30, timer:null };

    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

    async function loadQuestions(){
      const res = await fetch("questions.json");
      const data = await res.json();
      STATE.allData = data;
      STATE.pool = Object.values(data).flat();
      STATE.quiz = shuffle(STATE.pool).slice(0,10);
      renderQuestion();
    }

    function renderQuestion(){
      const q = STATE.quiz[STATE.idx];
      el("qCounter").textContent = `C√¢u ${STATE.idx+1}/10`;
      el("questionBox").innerHTML = formatPower(q.q);

      el("optionsBox").innerHTML = "";
      (q.options||[]).forEach((opt,i)=>{
        const btn = document.createElement("button");
        btn.className = "btn bg-white hover:bg-indigo-50";
        btn.innerHTML = `
          <div class="flex items-start">
            <span class="w-6 font-bold">${String.fromCharCode(65+i)}.</span>
            <span class="flex-1">${formatPower(opt)}</span>
          </div>
        `;
        btn.onclick = ()=>chooseAnswer(btn,opt,q.a);
        el("optionsBox").appendChild(btn);
      });

      STATE.timeLeft = STATE.duration;
      updateTimeBar();
      if(STATE.timer) clearInterval(STATE.timer);
      STATE.timer = setInterval(()=>{
        STATE.timeLeft--; updateTimeBar();
        if(STATE.timeLeft<=0){ timeUp(q); }
      },1000);
    }

    function updateTimeBar(){
      const pct = (STATE.timeLeft/STATE.duration)*100;
      const bar = el("timeBar");
      bar.style.width = pct+"%";
      bar.style.background = pct>50? "#10b981" : (pct>25? "#f59e0b" : "#ef4444");
      el("hudTime").textContent = STATE.timeLeft+"s";
    }

    function stopTimer(){
      if(STATE.timer){ clearInterval(STATE.timer); STATE.timer=null; }
    }

    function chooseAnswer(btn, selected, correct){
      if(!STATE.timer) return;
      stopTimer(); // ‚ùå d·ª´ng ngay khi ch·ªçn
      const buttons = [...el("optionsBox").children];
      buttons.forEach(b=>b.classList.add("disabled"));
      if(selected===correct){
        btn.classList.add("correct");
        STATE.score++; STATE.right++;
      } else {
        btn.classList.add("wrong");
        STATE.wrong++;
        buttons.forEach(b=>{
          if(b.textContent.includes(correct)) b.classList.add("correct");
        });
      }
      updateHUD();
    }

    function timeUp(q){
      stopTimer();
      const buttons = [...el("optionsBox").children];
      buttons.forEach(b=>{
        if(b.textContent.includes(q.a)) b.classList.add("correct");
        else b.classList.add("wrong");
        b.classList.add("disabled");
      });
      STATE.wrong++; updateHUD();
    }

    function nextQuestion(){
      if(STATE.idx<9){
        STATE.idx++; renderQuestion();
      } else {
        finishGame();
      }
    }

    function finishGame(){
      stopTimer();
      el("statusLine").textContent="üéâ Ho√†n th√†nh!";
    }

    function updateHUD(){
      el("hudScore").textContent=STATE.score;
      el("hudRightWrong").textContent=`${STATE.right} / ${STATE.wrong}`;
    }

    el("nextBtn").onclick=nextQuestion;

    loadQuestions();
  </script>
</body>
</html>
