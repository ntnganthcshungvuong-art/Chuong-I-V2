<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>üî• Quiz ƒê·ªëi Kh√°ng - C·ª≠a 1 vs C·ª≠a 2 üî•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; transition: background 0.3s; }
    .hidden { display: none; }
    #scoreBoard {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 50;
    }
  </style>
</head>
<body class="bg-gradient-to-r from-pink-100 to-blue-200 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold mb-6 text-center">üî• Quiz ƒê·ªëi Kh√°ng: C·ª≠a 1 vs C·ª≠a 2 üî•</h1>

  <!-- Menu -->
  <div id="menuScreen" class="text-center">
    <p class="mb-4 text-gray-700">Ch·ªçn c·ª≠a ƒë·ªÉ b·∫Øt ƒë·∫ßu thi ƒë·∫•u:</p>
    <div class="flex gap-6 justify-center">
      <button onclick="startGame(1)" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-lg">üîë C·ª≠a 1</button>
      <button onclick="startGame(2)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl shadow-lg">üîë C·ª≠a 2</button>
    </div>
  </div>

  <!-- Quiz cho t·ª´ng c·ª≠a -->
  <div id="quiz1" class="hidden w-full max-w-2xl mt-6 pb-32">
    <h2 class="text-xl font-bold text-red-600">C·ª≠a 1</h2>
    <p id="counter1" class="font-semibold">C√¢u 1/10</p>
    <div id="qBox1" class="bg-white p-4 rounded-xl shadow mb-3 text-lg font-medium"></div>
    <div id="opts1" class="grid gap-2"></div>
    <button onclick="nextQ(1)" id="nextBtn1" class="hidden mt-3 bg-green-500 text-white px-4 py-2 rounded-lg">C√¢u ti·∫øp</button>
  </div>

  <div id="quiz2" class="hidden w-full max-w-2xl mt-6 pb-32">
    <h2 class="text-xl font-bold text-blue-600">C·ª≠a 2</h2>
    <p id="counter2" class="font-semibold">C√¢u 1/10</p>
    <div id="qBox2" class="bg-white p-4 rounded-xl shadow mb-3 text-lg font-medium"></div>
    <div id="opts2" class="grid gap-2"></div>
    <button onclick="nextQ(2)" id="nextBtn2" class="hidden mt-3 bg-green-500 text-white px-4 py-2 rounded-lg">C√¢u ti·∫øp</button>
  </div>

  <!-- Scoreboard nh·ªè -->
  <div id="scoreBoard" class="hidden bg-white shadow-lg rounded-xl p-4">
    <p class="text-lg font-bold">üèÜ B·∫£ng ƒëi·ªÉm</p>
    <p>C·ª≠a 1: <span id="score1">0</span></p>
    <p>C·ª≠a 2: <span id="score2">0</span></p>
  </div>

  <!-- Scoreboard l·ªõn -->
  <div id="bigScore" class="hidden fixed bottom-0 left-1/2 transform -translate-x-1/2 bg-white/90 px-6 py-3 rounded-2xl shadow-2xl text-xl md:text-3xl font-extrabold">
    <span class="text-red-600">C·ª≠a 1: <span id="bigScore1">0</span></span> 
    <span class="mx-4">‚öîÔ∏è</span> 
    <span class="text-blue-600">C·ª≠a 2: <span id="bigScore2">0</span></span>
  </div>

  <!-- √Çm thanh Kahoot -->
  <audio id="soundCorrect" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c3a8f95c3a.mp3"></audio>
  <audio id="soundWrong" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_44f94a6e25.mp3"></audio>
  <audio id="soundWin" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b63f9a8f3f.mp3"></audio>
  <audio id="soundLose" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7d26e0d3b2.mp3"></audio>
  <audio id="soundBg" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f37d0c2a9.mp3" loop></audio>

<script>
let dataAll = {}, quizData1 = [], quizData2 = [];
let idx1=0, idx2=0, score1=0, score2=0;

async function startGame(door){
  if(Object.keys(dataAll).length===0){
    const res = await fetch("questions.json?_="+Date.now());
    dataAll = await res.json();
  }
  const allQs = [...(dataAll.Bai1||[]), ...(dataAll.Bai2||[]), ...(dataAll.Bai3||[]), ...(dataAll.Bai4||[]), ...(dataAll.Bai5||[])];

  document.getElementById("soundBg").play().catch(()=>{});

  if(door===1){
    quizData1 = pick(allQs,10);
    idx1=0; score1=0;
    document.getElementById('quiz1').classList.remove('hidden');
  }else{
    quizData2 = pick(allQs,10);
    idx2=0; score2=0;
    document.getElementById('quiz2').classList.remove('hidden');
  }
  document.getElementById('scoreBoard').classList.remove('hidden');
  document.getElementById('bigScore').classList.remove('hidden');
  showQ(door);
}

function showQ(door){
  let idx = (door===1?idx1:idx2);
  let quizData = (door===1?quizData1:quizData2);
  let q = quizData[idx];
  let cleanQ = q.q.replace(/^B√†i.*?:\s*/,'').replace("‚Å∫","+");
  document.getElementById('counter'+door).innerText = `C√¢u ${idx+1}/10`;
  document.getElementById('qBox'+door).innerHTML = `<span class="text-xl font-bold">${cleanQ}</span>`;
  let html = '';
  shuffle([...q.options]).forEach(opt=>{
    html += `<button onclick="answer(${door}, this, '${escape(q.a)}')" 
              class="bg-white border p-2 rounded-lg hover:bg-yellow-100 text-lg">${opt}</button>`;
  });
  document.getElementById('opts'+door).innerHTML = html;
  document.getElementById('nextBtn'+door).classList.add('hidden');
}

function answer(door,btn,correct){
  let chosen = btn.innerText.trim();
  let buttons = document.querySelectorAll('#opts'+door+' button');
  buttons.forEach(b=>b.disabled=true);
  if(chosen===correct){
    btn.classList.add('bg-green-300');
    playSound("soundCorrect");
    if(door===1){score1+=10;updateScore();}
    else{score2+=10;updateScore();}
  }else{
    btn.classList.add('bg-red-300');
    playSound("soundWrong");
    buttons.forEach(b=>{if(b.innerText.trim()===correct){b.classList.add('ring-2','ring-green-600')}})
  }
  document.getElementById('nextBtn'+door).classList.remove('hidden');
}

function updateScore(){
  document.getElementById('score1').innerText=score1;
  document.getElementById('score2').innerText=score2;
  document.getElementById('bigScore1').innerText=score1;
  document.getElementById('bigScore2').innerText=score2;
}

function nextQ(door){
  if(door===1){
    idx1++;
    if(idx1<quizData1.length){showQ(1);}else{endGame();}
  }else{
    idx2++;
    if(idx2<quizData2.length){showQ(2);}else{endGame();}
  }
}

function endGame(){
  if(idx1>=10 && idx2>=10){
    let msg="üéâ Tr·∫≠n ƒë·∫•u k·∫øt th√∫c!\n";
    msg+=`C·ª≠a 1: ${score1} ƒëi·ªÉm\nC·ª≠a 2: ${score2} ƒëi·ªÉm\n`;
    if(score1>score2){
      msg+="üëâ C·ª≠a 1 Th·∫Øng!";
      playSound("soundWin");
      flashBackground("red");
    }
    else if(score2>score1){
      msg+="üëâ C·ª≠a 2 Th·∫Øng!";
      playSound("soundWin");
      flashBackground("blue");
    }
    else{
      msg+="ü§ù H√≤a!";
      playSound("soundLose");
      flashBackground("gray");
    }
    alert(msg);
    document.getElementById("soundBg").pause();
  }
}

function playSound(id){
  let audio=document.getElementById(id);
  audio.currentTime=0;
  audio.play();
}

function flashBackground(color){
  let body=document.body;
  let i=0;
  let interval=setInterval(()=>{
    body.style.backgroundColor=(i%2===0?color:"white");
    i++;
    if(i>6){clearInterval(interval);body.style.background="";}
  },300);
}

function pick(arr,n){
  let out=[];for(let i=0;i<n;i++){out.push(arr[Math.floor(Math.random()*arr.length)]);}return out;
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;
}
function escape(s){
  return (s||'').replace(/'/g,"\\'").replace(/"/g,'\\"');
}
</script>

</body>
</html>
